{% load form_extras %}

<style>
    /* Prevent content from going over fixed header */
    body {
        background-color: #1e293b;
        color: #e2e8f0;
        font-family: system-ui, -apple-system, sans-serif;
        padding-top: 80px; /* Account for fixed header height */
    }

    /* Ensure header stays above everything */
    header {
        z-index: 9999 !important;
        background: rgba(15, 23, 42, 0.95) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
    }

    main {
        min-height: 100vh;
        background-color: #1e293b;
        position: relative;
        z-index: 1;
    }

    /* Toast positioning - top right */
    .toast {
        position: fixed !important;
        top: 90px !important; /* Adjusted to be below header */
        right: 20px !important;
        z-index: 1000;
        max-width: 400px;
    }

    .alert {
        background-color: #059669 !important;
        color: white !important;
        padding: 12px 16px;
        border-radius: 8px;
        border: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* Form styling */
    form {
        background-color: #334155 !important;
        border-radius: 12px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
        max-width: 1200px !important;
        width: 95% !important;
        margin: 20px auto !important;
        padding: 24px !important;
    }

    h1 {
        color: #f8fafc !important;
        border-bottom: 2px solid #475569;
        padding-bottom: 8px !important;
        margin-bottom: 24px !important;
    }

    .label {
        color: #e2e8f0 !important;
        margin-bottom: 6px !important;
        font-weight: 500 !important;
    }

    .input, .file-input {
        background-color: #475569 !important;
        border: 1px solid #64748b !important;
        color: #f8fafc !important;
        border-radius: 6px !important;
        padding: 10px 12px !important;
        width: 100% !important;
        margin-bottom: 8px !important;
    }

    .input:focus, .file-input:focus {
        outline: none !important;
        border-color: #3b82f6 !important;
        background-color: #525863 !important;
    }

    .btn {
        background-color: #3b82f6 !important;
        color: white !important;
        border: none !important;
        padding: 12px 24px !important;
        border-radius: 6px !important;
        font-weight: 600 !important;
        cursor: pointer;
        transition: background-color 0.2s !important;
    }

    .btn:hover {
        background-color: #2563eb !important;
    }

    .text-red-500 {
        color: #ef4444 !important;
        font-size: 14px !important;
        margin-top: 4px;
    }

    .fieldset {
        margin-bottom: 16px !important;
    }

    /* Responsive fixes */
    @media (max-width: 1024px) {
        form {
            width: 95% !important;
            padding: 20px !important;
        }
        
        .toast {
            right: 10px !important;
            max-width: 350px;
        }
    }

    @media (max-width: 768px) {
        form {
            width: 98% !important;
            padding: 16px !important;
        }
        h1 {
            font-size: 22px !important;
        }
        
        .toast {
            right: 8px !important;
            top: 85px !important;
            max-width: 300px;
        }
    }

    @media (max-width: 480px) {
        main {
            padding: 12px !important;
        }
        h1 {
            font-size: 20px !important;
        }
        
        .toast {
            right: 5px !important;
            top: 82px !important;
            max-width: 280px;
        }
    }
</style>

<main class="flex flex-col items-center justify-center min-h-screen w-full p-4">

    {% if not request.user.shop %}
    <div class="toast">
        <div class="alert alert-success text-center shadow-lg">
            <span class="block">Welcome to the dashboard! Please register your shop to get started.</span>
            <ul>
                {% for error in form.non_field_errors %}
                <span class="text-red-500 text-sm">{{ error }}</span>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}


    <!-- registration form  -->
    <form action="{{form_submission_url}}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- 2-column responsive grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

            <!-- Left Column -->
            <div>
                <h1 class="text-2xl font-bold mb-2">Shop Information</h1>
                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.name.id_for_label }}">{{form.name.label}}</label>
                    {{ form.name|add_class:"input" }}
                    {% for error in form.name.errors %}
                        <p class="text-red-500">{{ error }}</p>
                    {% endfor %}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.owner_name.id_for_label }}">{{form.owner_name.label}}</label>
                    {{ form.owner_name|add_class:"input" }}
                    {% for error in form.owner_name.errors %}
                        <p class="text-red-500">{{ error }}</p>
                    {% endfor %}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.established_date.id_for_label }}">{{form.established_date.label}}</label>
                    {{ form.established_date|add_class:"input" }}
                    {% for error in form.established_date.errors %}
                        <p class="text-red-500">{{ error }}</p>
                    {% endfor %}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.logo.id_for_label }}">{{form.logo.label}}</label>
                    {{ form.logo|add_class:"file-input" }}
                    {% for error in form.logo.errors %}
                        <p class="text-red-500">{{ error }}</p>
                    {% endfor %}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.banner.id_for_label }}">{{form.banner.label}}</label>
                    {{ form.banner|add_class:"file-input" }}
                    {% for error in form.banner.errors %}
                        <p class="text-red-500">{{ error }}</p>
                    {% endfor %}
                </fieldset>

                <h1 class="text-2xl font-bold mb-2 mt-6">Contact Information</h1>
                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.email.id_for_label }}">{{form.email.label}}</label>
                    {{ form.email|add_class:"input" }}
                    {% for error in form.email.errors %}
                        <p class="text-red-500">{{ error }}</p>
                    {% endfor %}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.phone_number.id_for_label }}">{{form.phone_number.label}}</label>
                    {{ form.phone_number|add_class:"input" }}
                    {% for error in form.phone_number.errors %}
                        <p class="text-red-500">{{ error }}</p>
                    {% endfor %}
                </fieldset>
            </div>

            <!-- Right Column -->
            <div>
                <h1 class="text-2xl font-bold mb-2">Address Information</h1>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <fieldset class="fieldset">
                        <label class="label text-lg" for="{{ form.address_line_1.id_for_label }}">{{form.address_line_1.label}}</label>
                        {{ form.address_line_1|add_class:"input" }}
                        {% for error in form.address_line_1.errors %}
                            <p class="text-red-500">{{ error }}</p>
                        {% endfor %}
                    </fieldset>

                    <fieldset class="fieldset">
                        <label class="label text-lg" for="{{ form.address_line_2.id_for_label }}">{{form.address_line_2.label}}</label>
                        {{ form.address_line_2|add_class:"input" }}
                        {% for error in form.address_line_2.errors %}
                            <p class="text-red-500">{{ error }}</p>
                        {% endfor %}
                    </fieldset>
                </div>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.city.id_for_label }}">{{form.city.label}}</label>
                    {{ form.city|add_class:"input" }}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.state.id_for_label }}">{{form.state.label}}</label>
                    {{ form.state|add_class:"input" }}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.country.id_for_label }}">{{form.country.label}}</label>
                    {{ form.country|add_class:"input" }}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.postal_code.id_for_label }}">{{form.postal_code.label}}</label>
                    {{ form.postal_code|add_class:"input" }}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.map_location_url.id_for_label }}">{{form.map_location_url.label}}</label>
                    {{ form.map_location_url|add_class:"input" }}
                </fieldset>

                <fieldset class="fieldset">
                    <label class="label text-lg" for="{{ form.registration_number.id_for_label }}">{{form.registration_number.label}}</label>
                    {{ form.registration_number|add_class:"input" }}
                </fieldset>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-full mt-10">
            {% if 'update' in form_submission_url %}
                Update
            {% else %}
                Register
            {% endif %}
        </button>
    </form>
</main>
<script>
    // Wait for page to load
    document.addEventListener("DOMContentLoaded", function () {
        // Target the alert div
        const alertBox = document.querySelector(".alert");

        if (alertBox) {
            // Remove after 5 seconds (5000 ms)
            setTimeout(() => {
                alertBox.style.transition = "opacity 0.5s ease"; 
                alertBox.style.opacity = "0";  

                // Completely remove from DOM after fade-out
                setTimeout(() => {
                    alertBox.remove();
                }, 500); 
            }, 5000); 
        }
    });
</script>